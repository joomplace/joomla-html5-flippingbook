function Countdown(e){function o(){i(r);if(r===0){s();n.stop()}r--}var t,n=this,r=e.seconds||10,i=e.onUpdateStatus||function(){},s=e.onCounterEnd||function(){};this.start=function(){clearInterval(t);t=0;r=e.seconds;t=setInterval(o,1e3)};this.stop=function(){clearInterval(t)}}var page=1,maxPage=1;var settings="",storedPage="";var defBackgr="#f9f9f9",defFontColor="#000";var changeBackgr="",changeFontColor="";if(typeof user==='undefined'||!user){$.cookie.json=true;settings=$.cookie("_reader-settings:guest");storedPage=$.cookie("_pub-page:guest")}$(window).on("orientationchange",function(){var e=$("#page");var t=$("#page-content").width();e.find("img").css("max-width",t);e.find("video").css("max-width",t)});$(document).on("pageinit","#settings",function(){$(".ui-icon-delete").on("click",function(){settings={showNavi:$('input[name="navi-buttons"]').is(":checked")?1:0,nightMode:$('input[name="night-mode"]').is(":checked")?1:0,backColor:$('input[name="backgroundcolor"]').val(),fontColor:$('input[name="fontcolor"]').val(),fontSize:parseInt($('input[name="fontsize"]').val())};if(typeof user==='undefined'||!user){$.cookie("_reader-settings:guest",settings,{expires:365,path:"/"})}else{$.ajax({type:"POST",url:realUrl+"index.php?option=com_html5flippingbook&task=userSettings&tmpl=component",data:"pubID="+pubID+"&settings="+JSON.stringify(settings),dataType:"JSON"})}});var e=$('input[name="fontsize"]');var t=12;if(typeof settings!="undefined"&&settings.fontSize){t=settings.fontSize}e.val(t).slider("refresh");e.on("slidestop",function(){$("#page").attr("style","font-size: "+$(this).val()+"px")})});$(document).ready(function(){var e=$('input[name="navi-buttons"]');var t=$('input[name="night-mode"]');var n=$('input[name="backgroundcolor"]');var r=$('input[name="fontcolor"]');var i=$('input[name="fontsize"]');var s=$("#page");if(typeof user!=='undefined'){$.ajax({type:"GET",url:realUrl+"index.php?option=com_html5flippingbook&task=userSettings&tmpl=component",data:"pubID="+pubID,dataType:"JSON",async:false,success:function(e){settings=JSON.parse(e.settings);storedPage=e.storedPage;page=storedPage.openPage;maxPage=storedPage.lastPage}});var o=new Countdown({seconds:90,onCounterEnd:function(){$.ajax({type:"POST",url:realUrl+"index.php?option=com_html5flippingbook&task=userPublAction&tmpl=component",data:"pubID="+pubID+"&action=updateSpendTime&sec=90",dataType:"JSON",success:function(){o.start()}})}});o.start();$.ajax({type:"POST",url:realUrl+"index.php?option=com_html5flippingbook&task=userPublAction&tmpl=component",data:"pubID="+pubID+"&action=lastopen",dataType:"JSON"})}if(typeof storedPage!="undefined"&&storedPage.publication==pubID&&(typeof user==='undefined'||!user)){page=storedPage.openPage;maxPage=storedPage.lastPage}getPage(page);if(typeof settings!="undefined"){if(settings.showNavi){$("#navi").show();e.attr("checked",true)}if(settings.nightMode){$("#page-container").css("background-color","#000");$("#page-content").css("background-color","#000");s.css("color","#FFF");t.attr("checked",true)}changeBackgr=settings.backColor;changeFontColor=settings.fontColor;if(!settings.nightMode&&changeBackgr!=""){$("#page-container").css("background-color",changeBackgr);$("#page-content").css("background-color",changeBackgr);n.val(changeBackgr)}if(!settings.nightMode&&changeFontColor!=""){s.css("color",changeFontColor);r.val(changeFontColor)}s.attr("style","font-size: "+settings.fontSize+"px")}r.minicolors({position:"top right"});n.minicolors({position:"bottom right"});e.on("change",function(){if(this.checked){$("#navi").show()}else{$("#navi").hide()}});t.on("change",function(){if(this.checked){$("#page-container").css("background-color","#000");$("#page-content").css("background-color","#000");s.css("color","#FFF")}else{defBackgr=changeBackgr!=""?changeBackgr:defBackgr;defFontColor=changeFontColor!=""?changeFontColor:defFontColor;$("#page-container").css("background-color",defBackgr);$("#page-content").css("background-color",defBackgr);s.css("color",defFontColor)}});n.on("change",function(){var e=$(this).val();changeBackgr=e;$("#page-container").css("background-color",e);$("#page-content").css("background-color",e)});r.on("change",function(){var e=$(this).val();changeFontColor=e;s.css("color",e)});$("#page-header").toolbar("hide");$("#page-footer").toolbar("hide");$('input[name="page-slider"]').on("slidestop",function(){page=jQuery(this).val();getPage(page)});$(document).on({swipeleft:function(){getPage(page++)},swiperight:function(){getPage(page--)}},"#page-container");$("#prev").on("tap",function(){getPage(page--)});$("#next").on("tap",function(){getPage(page++)})});getPage=function(e){if(page>maxPage||page==0){page=page==0?1:maxPage;return}var t=$("#page");var n=$('input[name="page-slider"]');n.val(page).slider("refresh");$.ajax({type:"GET",url:realUrl+"index.php?option=com_html5flippingbook&task=getPageContent&tmpl=component",data:"pubID="+pubID+"&page="+page,dataType:"JSON",success:function(e){maxPage=e.lastPage;if(typeof user==='undefined'||!user){storedPage={publication:pubID,openPage:page,lastPage:maxPage};$.cookie("_pub-page:guest",storedPage,{expires:365,path:"/"})}else{$.ajax({type:"POST",url:realUrl+"index.php?option=com_html5flippingbook&task=userPublAction&tmpl=component",data:"pubID="+pubID+"&action=updatePage&page="+page,dataType:"JSON"})}n.attr("max",maxPage);$("#book-title").text(e.title);$("#book-author").text(e.author);t.empty().append(e.content);var r=$("#page-content").width();t.find("img").css("max-width",r);t.find("video").css("max-width",r)}})}